/*:
 * @target MZ
 * @plugindesc ãƒ­ãƒ¼ãƒ‰ç›´å¾Œï¼ˆç”»é¢æš—è»¢ä¸­ï¼‰ã«ã‚³ãƒ¢ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’å³æ™‚å®Ÿè¡Œã™ã‚‹
 * @author ChatGPT
 *
 * @param CommonEventId
 * @text ã‚³ãƒ¢ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆID
 * @type common_event
 * @default 153
 * @desc ãƒ­ãƒ¼ãƒ‰ç›´å¾Œã«èµ°ã‚‰ã›ãŸã„ã‚³ãƒ¢ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆç•ªå·
 *
 * @help
 * ----------------------------------------------------
 * â– æ¦‚è¦
 *  1. Scene_Load.onLoadSuccess ã§ã€Œãƒ­ãƒ¼ãƒ‰æˆåŠŸã€ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
 *  2. Scene_Map.start ã® *å†’é ­* ã§ãã®ãƒ•ãƒ©ã‚°ã‚’æ¤œçŸ¥ã—ã€
 *     æŒ‡å®šã‚³ãƒ¢ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’ *ç‹¬ç«‹ Interpreter* ã§å³æ™‚å®Ÿè¡Œ
 *  3. å®Œäº†å¾Œã«é€šå¸¸ã® start ã‚’å‘¼ã¶ â†’ ãã®ç›´å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³é–‹å§‹
 *
 *  ã“ã‚Œã«ã‚ˆã‚Šã€ç”»é¢ãŒçœŸã£é»’ãªã†ã¡ã«ã‚¹ã‚¤ãƒƒãƒæ“ä½œãƒ»å¤‰æ•°æ“ä½œãªã©
 *  ãƒ­ã‚¸ãƒƒã‚¯ç³»ã‚³ãƒãƒ³ãƒ‰ã‚’å®Œäº†ã•ã›ã‚‰ã‚Œã¾ã™ã€‚
 *
 * â– æ³¨æ„
 *  ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã€ãƒ”ã‚¯ãƒãƒ£è¡¨ç¤ºã€ã‚¦ã‚§ã‚¤ãƒˆã‚’å«ã‚€ã¨æš—è»¢ä¸­ã«
 *    è£ã§å®Ÿè¡Œã•ã‚Œãƒ¦ãƒ¼ã‚¶ã«è¦‹ãˆã¾ã›ã‚“ã€‚ãƒ­ã‚¸ãƒƒã‚¯å‡¦ç†å°‚ç”¨ã¨è€ƒãˆã¦
 *    ãã ã•ã„ã€‚
 *  ãƒ»ãƒ‹ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒ æ™‚ã«ã¯ç™ºç«ã—ã¾ã›ã‚“ã€‚
 *
 * â– æ›´æ–°å±¥æ­´
 *   1.0.0 (2025â€‘05â€‘13) åˆç‰ˆ
 * ---------------------------------------------------- */
(() => {
  "use strict";

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const pluginName = "LoadCE_Instant";
  const params     = PluginManager.parameters(pluginName);
  const CE_ID      = Number(params.CommonEventId || 1);

  // ãƒ­ãƒ¼ãƒ‰æˆåŠŸãƒ•ãƒ©ã‚°ã‚’ $gameSystem ã«ä¿æŒ
  const LOAD_FLAG  = "_loadCE_InstantFlag";

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // 1) Scene_Load.onLoadSuccess : ãƒ•ãƒ©ã‚° ON
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const _Scene_Load_onLoadSuccess = Scene_Load.prototype.onLoadSuccess;
  Scene_Load.prototype.onLoadSuccess = function() {
    $gameSystem[LOAD_FLAG] = true;      // ãƒ­ãƒ¼ãƒ‰æˆåŠŸã‚’è¨˜éŒ²
    _Scene_Load_onLoadSuccess.call(this);
  };

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // 2) Scene_Map.start : ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³å‰ã«å³å®Ÿè¡Œ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const _Scene_Map_start = Scene_Map.prototype.start;
  Scene_Map.prototype.start = function() {

    // ğŸ”¸ã“ã“ã¯ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãŒèµ°ã‚‹å‰
    if ($gameSystem[LOAD_FLAG]) {
      $gameSystem[LOAD_FLAG] = false;   // ä¸€åº¦ãã‚Š

      const ce = $dataCommonEvents[CE_ID];
      if (ce) {
        const interpreter = new Game_Interpreter();
        interpreter.setup(ce.list, 0);

        // å…¨ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸€æ°—ã«å‡¦ç†
        while (interpreter.isRunning()) {
          interpreter.update();
        }
      }
    }

    // é€šå¸¸ã®å‡¦ç†ï¼ˆã“ã®ä¸­ã§ fadeIn ãŒå§‹ã¾ã‚‹ï¼‰
    _Scene_Map_start.call(this);
  };
})();
